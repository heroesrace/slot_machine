<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎰 MEGA FORTUNE SLOTS 2025 - Premium Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea, #764ba2);
            --gold-gradient: linear-gradient(135deg, #ffd93d, #ff9068);
            --neon-blue: #00ffff;
            --neon-pink: #ff006e;
            --neon-green: #39ff14;
            --dark-bg: #0a0a0a;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            user-select: none;
        }

        /* Animated orb background */
        .bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460, #1a1a2e);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(2px);
            opacity: 0.3;
            animation: orbFloat 20s infinite linear;
        }

        .orb:nth-child(1) {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--neon-blue), transparent);
            top: 20%;
            left: -100px;
            animation-duration: 25s;
        }

        .orb:nth-child(2) {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--neon-pink), transparent);
            top: 60%;
            left: -75px;
            animation-duration: 30s;
            animation-delay: -10s;
        }

        .orb:nth-child(3) {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--neon-green), transparent);
            top: 80%;
            left: -150px;
            animation-duration: 35s;
            animation-delay: -20s;
        }

        @keyframes orbFloat {
            0% { transform: translateX(-200px) translateY(0px) rotate(0deg); }
            100% { transform: translateX(calc(100vw + 200px)) translateY(-100px) rotate(360deg); }
        }

        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 1;
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 30px;
            min-height: 100vh;
            align-items: start;
        }

        /* Enhanced glassmorphism */
        .card {
            background: linear-gradient(145deg, 
                rgba(255, 255, 255, 0.1), 
                rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 30px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .card:hover {
            transform: translateY(-8px);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        /* Left panel - Rules */
        .rules-panel {
            position: sticky;
            top: 20px;
        }

        .panel-title {
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
        }

        .panel-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: var(--primary-gradient);
            border-radius: 2px;
        }

        .how-to-play {
            margin-bottom: 20px;
        }

        .how-to-play h4 {
            font-size: 16px;
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .how-to-play p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .how-to-play strong {
            color: #4ecdc4;
            font-weight: 600;
        }

        .prize-table-title {
            color: #ffd93d;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rules-grid {
            display: grid;
            gap: 6px;
        }

        .rule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .rule-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(78, 205, 196, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .rule-item:hover {
            background: rgba(0, 0, 0, 0.6);
            border-color: rgba(78, 205, 196, 0.5);
            transform: translateX(5px) scale(1.02);
        }

        .rule-item:hover::before {
            left: 100%;
        }

        .rule-range {
            font-size: 11px;
            color: #4ecdc4;
            font-weight: 500;
        }

        .rule-prize {
            font-size: 12px;
            font-weight: 600;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .special-rule {
            background: rgba(255, 107, 107, 0.15);
            border-color: rgba(255, 107, 107, 0.4);
            animation: specialGlow 3s ease-in-out infinite;
        }

        .special-rule .rule-prize {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 13px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes specialGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 107, 107, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 107, 107, 0.6); }
        }

        @keyframes glow {
            from { filter: brightness(1); }
            to { filter: brightness(1.3); }
        }

        .hint {
            color: rgba(255, 255, 255, 0.6);
            font-size: 10px;
            margin-top: 10px;
            text-align: center;
            font-style: italic;
        }

        /* Center panel - Enhanced Game */
        .game-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .game-title {
            font-family: 'Orbitron', monospace;
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb, #f5576c, #ffd93d);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 4px;
            animation: rainbowGradient 8s ease-in-out infinite;
            text-align: center;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.5));
        }

        @keyframes rainbowGradient {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 200% 50%; }
            75% { background-position: 300% 50%; }
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: rgba(78, 205, 196, 0.5);
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 20px;
            font-weight: 700;
            color: #4ecdc4;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Enhanced slot machine - NEW 5x3 LAYOUT */
        .slot-machine {
            background: linear-gradient(145deg, #000, #1a1a1a, #000);
            border-radius: 20px;
            padding: 40px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            position: relative;
            box-shadow: 
                0 0 50px rgba(102, 126, 234, 0.2),
                inset 0 0 30px rgba(0, 0, 0, 0.8);
        }

        .reels-container {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 20px;
    height: 600px; /* Увеличил с 500px до 600px */
    margin-bottom: 30px;
    position: relative;
    border-radius: 15px;
    overflow: hidden;
    background: linear-gradient(180deg, rgba(0,0,0,0.9), rgba(0,0,0,0.3), rgba(0,0,0,0.9));
}

.reel {
    height: 100%;
    overflow: hidden;
    background: linear-gradient(180deg, 
        rgba(0,0,0,0.95) 0%, 
        rgba(0,0,0,0.2) 20%, 
        rgba(0,0,0,0.1) 50%, 
        rgba(0,0,0,0.2) 80%, 
        rgba(0,0,0,0.95) 100%);
    border-radius: 12px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    position: relative;
    box-shadow: 
        inset 0 0 30px rgba(0, 0, 0, 0.9),
        0 0 20px rgba(102, 126, 234, 0.1);
}

        .reel-inner {
            position: absolute;
            left: 0;
            width: 100%;
            transition: none;
        }

     .symbol {
    height: 200px; /* Увеличил с 166.67px до 200px */
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 70px; /* Уменьшил с 80px до 70px для лучшего соответствия */
    text-shadow: 0 0 20px currentColor;
    position: relative;
    transition: all 0.3s ease;
}

        .symbol.winning {
            animation: megaWinSymbol 1s ease-in-out infinite;
            transform: scale(1.2);
            filter: brightness(2) drop-shadow(0 0 30px currentColor);
            z-index: 10;
        }

        @keyframes megaWinSymbol {
            0%, 100% { 
                transform: scale(1.2) rotate(0deg); 
                filter: brightness(2) drop-shadow(0 0 30px currentColor);
            }
            25% { 
                transform: scale(1.4) rotate(5deg); 
                filter: brightness(2.5) drop-shadow(0 0 40px currentColor);
            }
            75% { 
                transform: scale(1.4) rotate(-5deg); 
                filter: brightness(2.5) drop-shadow(0 0 40px currentColor);
            }
        }

        /* Enhanced paylines for 5x3 grid */
        .paylines {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 10;
            pointer-events: none;
        }

        .payline {
            position: absolute;
            display: none;
            border-radius: 3px;
        }

        .payline-active {
            display: block !important;
            animation: superLineGlow 2s ease-in-out infinite;
        }

        /* Horizontal paylines */
        .payline-1 { 
            top: 16.67%; 
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, transparent 2%, var(--neon-pink) 50%, transparent 98%); 
            box-shadow: 0 0 20px var(--neon-pink), 0 0 40px var(--neon-pink);
        } 

        .payline-2 { 
            top: 50%; 
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, transparent 2%, var(--neon-blue) 50%, transparent 98%); 
            box-shadow: 0 0 20px var(--neon-blue), 0 0 40px var(--neon-blue);
        } 

        .payline-3 { 
            top: 83.33%; 
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, transparent 2%, var(--neon-green) 50%, transparent 98%); 
            box-shadow: 0 0 20px var(--neon-green), 0 0 40px var(--neon-green);
        }

        /* Diagonal paylines for 5x3 */
        .payline-4 {
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent 48%, #ffd700 50%, transparent 52%);
            transform: skewY(-8deg);
            box-shadow: 0 0 20px #ffd700;
        }

        .payline-5 {
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(-135deg, transparent 48%, #ff9068 50%, transparent 52%);
            transform: skewY(8deg);
            box-shadow: 0 0 20px #ff9068;
        }

        @keyframes superLineGlow {
            0%, 100% { 
                opacity: 0.8; 
                transform: scaleY(1) scaleX(1);
                filter: blur(0px);
            }
            25% { 
                opacity: 1; 
                transform: scaleY(1.5) scaleX(1.05);
                filter: blur(1px);
            }
            75% { 
                opacity: 1; 
                transform: scaleY(1.5) scaleX(1.05);
                filter: blur(1px);
            }
        }

        /* Sound controls */
        .sound-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .sound-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sound-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
            transform: scale(1.1);
        }

        .sound-btn.active {
            background: #4ecdc4;
            color: #000;
        }

        /* Enhanced buttons */
        .spin-btn {
            display: block;
            margin: 0 auto 20px;
            padding: 22px 60px;
            font-family: 'Orbitron', monospace;
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 3px;
            color: white;
            background: var(--primary-gradient);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 10px 30px rgba(102, 126, 234, 0.4),
                0 0 0 0 rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .spin-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .spin-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 
                0 15px 40px rgba(102, 126, 234, 0.6),
                0 0 0 20px rgba(102, 126, 234, 0.1);
        }

        .spin-btn:hover::before {
            left: 100%;
        }

        .spin-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Results */
        .spin-results {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .spin-result {
            flex: 1;
            min-width: 120px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transform: translateY(20px);
            animation: resultAppear 0.5s forwards;
        }

        @keyframes resultAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .spin-result-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 5px;
        }

        .spin-result-value {
            font-family: 'Orbitron', monospace;
            font-size: 20px;
            font-weight: 700;
            color: #4ecdc4;
        }

        .spin-result.no-win {
            background: rgba(255, 0, 0, 0.1);
            border-color: rgba(255, 0, 0, 0.3);
        }

        .spin-result.no-win .spin-result-value {
            color: #ff6b6b;
        }

        .spin-result.big-win {
            background: rgba(255, 99, 71, 0.15);
            border-color: rgba(255, 99, 71, 0.4);
            animation: bigWinPulse 1s ease-in-out infinite;
        }
        
        .spin-result.mega-win {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.4);
            animation: megaWinPulse 1s ease-in-out infinite;
        }
        
        @keyframes bigWinPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 99, 71, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 99, 71, 0.6); }
        }
        
        @keyframes megaWinPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }

        .total-win {
            text-align: center;
            font-family: 'Orbitron', monospace;
            font-size: 36px;
            font-weight: 900;
            margin: 20px 0;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s ease;
        }

        .total-win.show {
            opacity: 1;
            transform: scale(1);
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: winPulse 1s ease-in-out infinite;
        }

        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Right panel - Agent Portal */
        .agent-panel {
            position: sticky;
            top: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #4ecdc4;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .input-group input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }
        
        .start-game-btn {
            width: 100%;
            padding: 18px;
            font-family: 'Orbitron', monospace;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 2px;
            color: white;
            background: var(--primary-gradient);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .start-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        .start-game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Enhanced Leaderboard */
        .leaderboard-filters {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .filter-btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-btn.active {
            background: var(--primary-gradient);
            color: white;
            border-color: rgba(102, 126, 234, 0.5);
        }

        .filter-btn:hover {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
        }

        .leaderboard-header {
            display: grid;
            grid-template-columns: 40px 2fr 1fr 1fr;
            gap: 10px;
            padding: 10px 15px;
            font-size: 11px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .agents-history {
            max-height: 400px;
            overflow-y: auto;
        }

        .agents-history::-webkit-scrollbar {
            width: 6px;
        }

        .agents-history::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        .agents-history::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }

        .agent-row {
            display: grid;
            grid-template-columns: 40px 2fr 1fr 1fr;
            gap: 10px;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: leaderboardSlideIn 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        @keyframes leaderboardSlideIn {
            from {
                opacity: 0;
                transform: translateX(-30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .agent-row::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(78, 205, 196, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .agent-row:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: rgba(78, 205, 196, 0.4);
            transform: scale(1.03) translateX(5px);
            box-shadow: 0 5px 20px rgba(78, 205, 196, 0.2);
        }

        .agent-row:hover::before {
            left: 100%;
        }

        .agent-rank {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: #ffd93d;
        }

        .rank-badge {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }

        .rank-1 { background: linear-gradient(45deg, #ffd700, #ffed4e); color: #000; }
        .rank-2 { background: linear-gradient(45deg, #c0c0c0, #e8e8e8); color: #000; }
        .rank-3 { background: linear-gradient(45deg, #cd7f32, #daa520); color: #fff; }
        .rank-other { background: rgba(102, 126, 234, 0.3); color: #667eea; }

        .agent-name {
            font-weight: 600;
            color: #4ecdc4;
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .vip-badge {
            margin-left: 8px;
            padding: 2px 6px;
            font-size: 9px;
            background: var(--gold-gradient);
            color: #000;
            border-radius: 4px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .agent-amount {
            font-weight: 500;
            color: #667eea;
            font-size: 14px;
            text-align: center;
        }

        .agent-prize {
            font-weight: 700;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 16px;
            text-align: right;
        }

        .empty-history {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
            padding: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            border: 1px dashed rgba(255, 255, 255, 0.1);
        }

        /* Fireworks */
        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: fireworkExplode 1.5s ease-out forwards;
        }

        @keyframes fireworkExplode {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(3);
                opacity: 0;
            }
        }

        /* Screen shake */
        @keyframes screenShake {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-10px); }
            20% { transform: translateX(10px); }
            30% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            50% { transform: translateX(-6px); }
            60% { transform: translateX(6px); }
            70% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
            90% { transform: translateX(-2px); }
        }

        .screen-shake {
            animation: screenShake 0.8s ease-in-out;
        }

        /* Enhanced particles */
        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 998;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            animation: advancedParticleFall 4s ease-out forwards;
        }

        @keyframes advancedParticleFall {
            0% {
                transform: translateY(-100vh) rotate(0deg) scale(1);
                opacity: 1;
            }
            25% {
                transform: translateY(-50vh) rotate(90deg) scale(1.2);
                opacity: 1;
            }
            50% {
                transform: translateY(0) rotate(180deg) scale(1);
                opacity: 0.8;
            }
            75% {
                transform: translateY(50vh) rotate(270deg) scale(0.8);
                opacity: 0.6;
            }
            100% {
                transform: translateY(100vh) rotate(360deg) scale(0.5);
                opacity: 0;
            }
        }

        /* Mega win animations */
        .mega-win-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 1000;
            pointer-events: none;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.1), rgba(0, 0, 0, 0.8));
        }

        .mega-win-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: megaWinPulse 3s ease-in-out;
        }

        @keyframes megaWinPulse {
            0%, 100% { 
                background: radial-gradient(circle, rgba(255, 215, 0, 0.1), rgba(0, 0, 0, 0.8));
            }
            50% { 
                background: radial-gradient(circle, rgba(255, 215, 0, 0.3), rgba(255, 0, 110, 0.1));
            }
        }

        .mega-win-text {
            font-family: 'Orbitron', monospace;
            font-size: 100px;
            font-weight: 900;
            text-transform: uppercase;
            background: linear-gradient(45deg, #ffd700, #ffa500, #ff6347, #ff1493, #9400d3, #ffd700);
            background-size: 600% 600%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: megaWinRainbow 2s ease-in-out infinite, megaWinScale 1s ease-out;
            text-align: center;
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
        }

        @keyframes megaWinRainbow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes megaWinScale {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.3) rotate(0deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* Responsive design */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 20px;
            }

            .rules-panel, .agent-panel {
                position: static;
            }

            .game-title {
                font-size: 32px;
            }

            .reels-container {
        height: 450px; /* Увеличил с 300px до 450px */
    }

    .symbol {
        height: 150px; /* Увеличил с 100px до 150px */
        font-size: 55px; /* Увеличил с 48px до 55px */
    }

        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .card {
                padding: 20px;
            }

            .game-title {
                font-size: 24px;
                letter-spacing: 2px;
            }

             .reels-container {
        height: 360px; /* Увеличил с 240px до 360px */
        gap: 15px; /* Увеличил с 10px до 15px */
    }

    .symbol {
        height: 120px; /* Увеличил с 80px до 120px */
        font-size: 45px; /* Увеличил с 36px до 45px */
    }


            .spin-btn {
                font-size: 16px;
                padding: 15px 40px;
            }

            .mega-win-text {
                font-size: 60px;
            }

            .agent-row {
                grid-template-columns: 1fr;
                gap: 5px;
                text-align: center;
            }

            .agent-amount, .agent-prize {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="bg-container"></div>
    <div class="orbs">
        <div class="orb"></div>
        <div class="orb"></div>
        <div class="orb"></div>
    </div>
    <div class="grid-overlay"></div>
    <div class="particles" id="particles"></div>
    <div class="fireworks" id="fireworks"></div>

    <div class="sound-controls">
        <button class="sound-btn active" id="sound-toggle" title="Toggle Sound">🔊</button>
        <button class="sound-btn active" id="vibration-toggle" title="Toggle Vibration">📳</button>
    </div>

    <div class="container">
        <!-- Left panel - Rules -->
        <div class="rules-panel card">
            <h2 class="panel-title">Game Rules</h2>
            
            <div class="how-to-play">
                <h4>How to Play</h4>
                <p>Pick any amount (minimum <strong>$1,000</strong>) and press <strong>SPIN TO WIN</strong>.</p>
                <p>Higher amounts unlock bigger prizes and more paylines!</p>
                <p><strong>💎 MEGA WINS:</strong> Special effects for huge prizes!</p>
            </div>

            <h4 class="prize-table-title">Prize Table</h4>
            <div class="rules-grid">
                <div class="rule-item">
                    <span class="rule-range">$1,000 - $2,500</span>
                    <span class="rule-prize">$50 · $100 · $125</span>
                </div>
                <div class="rule-item">
                    <span class="rule-range">$2,501 - $4,000</span>
                    <span class="rule-prize">$150 · $175 · $200</span>
                </div>
                <div class="rule-item">
                    <span class="rule-range">$4,001 - $6,000</span>
                    <span class="rule-prize">$225 · $250 · $300</span>
                </div>
                <div class="rule-item">
                    <span class="rule-range">$6,001 - $8,000</span>
                    <span class="rule-prize">$325 · $350 · $400</span>
                </div>
                <div class="rule-item">
                    <span class="rule-range">$8,001 - $12,000</span>
                    <span class="rule-prize">$450 · $550 · $600 · 🎁</span>
                </div>
                <div class="rule-item">
                    <span class="rule-range">$12,001 - $17,500</span>
                    <span class="rule-prize">$650 · $750 · $850 · 🎁</span>
                </div>
                <div class="rule-item">
                    <span class="rule-range">$17,501 - $25,000</span>
                    <span class="rule-prize">$900 · $1,100 · $1,200 · 🎁</span>
                </div>
                <div class="rule-item">
                    <span class="rule-range">$25,001 - $100,000</span>
                    <span class="rule-prize">$1,500 · 💎</span>
                </div>
                <div class="rule-item special-rule">
                    <span class="rule-range">$100,001+</span>
                    <span class="rule-prize">MEGA ⭐ 💥</span>
                </div>
            </div>

            <p class="hint">
                💡 Higher bets = More paylines + Better effects!<br>
                🎆 $1000+ = Fireworks on big wins<br>
                ⌨️ Shortcuts: Space=Spin, S=Sound, V=Vibration
            </p>
        </div>

        <!-- Center panel - Game -->
        <div class="game-panel">
            <div class="card">
                <div class="game-header">
                    <h1 class="game-title">💎 MEGA FORTUNE SLOTS 💎</h1>
                </div>
                
                <div class="game-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total-players">0</div>
                        <div class="stat-label">Players</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-winnings">$0</div>
                        <div class="stat-label">Total Won</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="current-agent">Waiting...</div>
                        <div class="stat-label">Current Agent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="spin-counter">0</div>
                        <div class="stat-label">Spins Left</div>
                    </div>
                </div>

                <div class="slot-machine">
                    <div class="reels-container">
                        <div class="paylines">
                            <div class="payline payline-1"></div>
                            <div class="payline payline-2"></div>
                            <div class="payline payline-3"></div>
                            <div class="payline payline-4"></div>
                            <div class="payline payline-5"></div>
                        </div>
                        <div class="reel" id="reel1">
                            <div class="reel-inner" id="reel1-inner"></div>
                        </div>
                        <div class="reel" id="reel2">
                            <div class="reel-inner" id="reel2-inner"></div>
                        </div>
                        <div class="reel" id="reel3">
                            <div class="reel-inner" id="reel3-inner"></div>
                        </div>
                        <div class="reel" id="reel4">
                            <div class="reel-inner" id="reel4-inner"></div>
                        </div>
                        <div class="reel" id="reel5">
                            <div class="reel-inner" id="reel5-inner"></div>
                        </div>
                    </div>
                </div>

                <button class="spin-btn" id="spin-btn" disabled>🎰 SPIN TO WIN 🎰</button>
                <div class="spin-results" id="spin-results"></div>
                <div class="total-win" id="total-win"></div>
            </div>
        </div>

        <!-- Right panel - Agent Portal & Leaderboard -->
        <div class="agent-panel">
            <div class="card">
                <h2 class="panel-title">Agent Portal</h2>
                <div class="input-group">
                    <label for="agent-name">Agent Name</label>
                    <input type="text" id="agent-name" placeholder="Enter agent name...">
                </div>
                <div class="input-group">
                    <label for="transaction-amount">Transaction Amount ($)</label>
                    <input type="number" id="transaction-amount" placeholder="Enter amount (min $1,000)..." min="1000">
                </div>
                <button class="start-game-btn" id="start-game-btn">🚀 START GAME</button>
            </div>
            
            <div class="card">
                <h2 class="panel-title">🏆 Leaderboard</h2>
                
                <div class="leaderboard-filters">
                    <button class="filter-btn active" data-filter="all">All Time</button>
                    <button class="filter-btn" data-filter="today">Today</button>
                    <button class="filter-btn" data-filter="big">Big Bets</button>
                </div>
                
                <div class="leaderboard-header">
                    <div>Rank</div>
                    <div>Agent</div>
                    <div>Bet</div>
                    <div>Prize</div>
                </div>
                
                <div class="agents-history" id="agents-history">
                    <div class="empty-history">
                        🎰 No winners yet. Be the first to play and claim the crown! 👑
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mega-win-overlay" id="mega-win-overlay">
        <div class="mega-win-text" id="mega-win-text">💎 MEGA WIN! 💎</div>
    </div>

    <script>
        // Enhanced symbols
        const symbols = [
            { icon: '💎', color: '#4ecdc4', name: 'Diamond', rarity: 'legendary' },
            { icon: '🔔', color: '#ffd93d', name: 'Bell', rarity: 'rare' },
            { icon: '🍒', color: '#ff6b6b', name: 'Cherry', rarity: 'common' },
            { icon: '🍋', color: '#f9ca24', name: 'Lemon', rarity: 'common' },
            { icon: '🍊', color: '#ff9068', name: 'Orange', rarity: 'common' },
            { icon: '🍇', color: '#9c88ff', name: 'Grapes', rarity: 'uncommon' },
            { icon: '⭐', color: '#667eea', name: 'Star', rarity: 'rare' },
            { icon: '💰', color: '#2ed573', name: 'Money', rarity: 'rare' },
            { icon: '🎰', color: '#ff6348', name: 'Slot', rarity: 'uncommon' },
            { icon: '🔥', color: '#ff4757', name: 'Fire', rarity: 'legendary' },
            { icon: '⚡', color: '#3742fa', name: 'Lightning', rarity: 'legendary' }
        ];

        const prizeRules = [
            { min: 1000, max: 2500, prizes: [50, 100, 125] },
            { min: 2501, max: 4000, prizes: [150, 175, 200] },
            { min: 4001, max: 6000, prizes: [225, 250, 300] },
            { min: 6001, max: 8000, prizes: [325, 350, 400] },
            { min: 8001, max: 12000, prizes: [450, 550, 600] },
            { min: 12001, max: 17500, prizes: [650, 750, 850] },
            { min: 17501, max: 25000, prizes: [900, 1100, 1200] },
            { min: 25001, max: 100000, prizes: [1500] },
            { min: 100001, max: Infinity, prizes: [2000, 2500, 3000, 5000] }
        ];

        // Game state
        let currentAgent = null;
        let currentAmount = 0;
        let targetPrize = 0;
        let spinsRemaining = 5;
        let spinResults = [];
        let isSpinning = false;
        let agentsHistory = [];
        let currentSpinWins = [];
        let totalPlayers = 0;
        let totalWinnings = 0;
        let soundEnabled = true;
        let vibrationEnabled = true;
        let currentFilter = 'all';
        let plannedWins = [];
        let currentSpinIndex = 0;

        // DOM elements
        const agentNameInput = document.getElementById('agent-name');
        const transactionAmountInput = document.getElementById('transaction-amount');
        const startGameBtn = document.getElementById('start-game-btn');
        const spinBtn = document.getElementById('spin-btn');
        const currentAgentEl = document.getElementById('current-agent');
        const spinCounterEl = document.getElementById('spin-counter');
        const spinResultsEl = document.getElementById('spin-results');
        const totalWinEl = document.getElementById('total-win');
        const megaWinOverlay = document.getElementById('mega-win-overlay');
        const megaWinText = document.getElementById('mega-win-text');
        const agentsHistoryEl = document.getElementById('agents-history');
        const particlesEl = document.getElementById('particles');
        const fireworksEl = document.getElementById('fireworks');
        const soundToggle = document.getElementById('sound-toggle');
        const vibrationToggle = document.getElementById('vibration-toggle');
        const totalPlayersEl = document.getElementById('total-players');
        const totalWinningsEl = document.getElementById('total-winnings');
        const filterBtns = document.querySelectorAll('.filter-btn');

        // Updated for 5 reels
        const reels = [
            document.getElementById('reel1-inner'),
            document.getElementById('reel2-inner'),
            document.getElementById('reel3-inner'),
            document.getElementById('reel4-inner'),
            document.getElementById('reel5-inner')
        ];

        // Initialize reels with symbols (Updated for 5x3)
        function initializeReels() {
            reels.forEach((reel) => {
                reel.innerHTML = ''; // Clear existing content
                
                // Create initial symbols (3 rows visible + buffer)
                for (let i = 0; i < 15; i++) { // Increased to 15 for smoother animation
                    const symbolData = getRandomSymbol();
                    const symbolDiv = document.createElement('div');
                    symbolDiv.className = 'symbol';
                    symbolDiv.innerHTML = symbolData.icon;
                    symbolDiv.style.color = symbolData.color;
                    symbolDiv.dataset.name = symbolData.name;
                    symbolDiv.dataset.rarity = symbolData.rarity;
                    reel.appendChild(symbolDiv);
                }
                
                // Position reel to show middle symbols
reel.style.top = '-400px';            });
        }

        // Get random symbol based on rarity
        function getRandomSymbol() {
            const rand = Math.random();
            let rarityPool;
            
            if (rand < 0.6) {
                rarityPool = symbols.filter(s => s.rarity === 'common');
            } else if (rand < 0.85) {
                rarityPool = symbols.filter(s => s.rarity === 'uncommon');
            } else if (rand < 0.96) {
                rarityPool = symbols.filter(s => s.rarity === 'rare');
            } else {
                rarityPool = symbols.filter(s => s.rarity === 'legendary');
            }
            
            return rarityPool[Math.floor(Math.random() * rarityPool.length)];
        }

        // Sound effects
        const sounds = {
            spin: () => playSound(800, 0.1, 'sine'),
            win: () => playSound(1200, 0.2, 'square'),
            megaWin: () => playSound(1600, 0.3, 'sawtooth'),
            click: () => playSound(600, 0.05, 'sine'),
            reelStop: () => playSound(500, 0.1, 'triangle')
        };

        // Restore state from localStorage
        (function restoreState() {
            const saved = JSON.parse(localStorage.getItem('agentsHistory') || '[]');
            if (!saved.length) return;

            agentsHistory = saved;
            totalPlayers = agentsHistory.length;
            totalWinnings = agentsHistory.reduce((s, a) => s + a.prize, 0);

            totalPlayersEl.textContent = totalPlayers;
            totalWinningsEl.textContent = `${totalWinnings.toLocaleString()}`;

            updateLeaderboard();
        })();

        function playSound(frequency, duration, type = 'sine') {
            if (!soundEnabled) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            gainNode.gain.value = 0.1;
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }

        // Vibration
        function vibrate(pattern) {
            if (!vibrationEnabled || !navigator.vibrate) return;
            navigator.vibrate(pattern);
        }

        // Generate wins distribution for guaranteed prize
        function generateWinsDistribution(targetPrize, spins) {
            const wins = new Array(spins).fill(0);
            let remaining = targetPrize;
            const step = 25; // round to 25
            
            for (let i = 0; i < spins - 1; i++) {
                if (remaining > 0 && Math.random() > 0.5) {
                    const max = Math.min(remaining, targetPrize - step);
                    const chunks = Math.floor(max / step);
                    const win = Math.floor(Math.random() * chunks + 1) * step;
                    wins[i] = win;
                    remaining -= win;
                }
            }
            
            wins[Math.floor(Math.random() * spins)] += remaining;
            return wins;
        }

        // Payline positions
        function paylineCoords(line) {
            switch (line) {
                case 1: return [[0,0],[1,0],[2,0],[3,0],[4,0]];      // top
                case 2: return [[0,1],[1,1],[2,1],[3,1],[4,1]];      // mid
                case 3: return [[0,2],[1,2],[2,2],[3,2],[4,2]];      // bottom
                case 4: return [[0,0],[1,1],[2,2],[3,1],[4,0]];      // V
                case 5: return [[0,2],[1,1],[2,0],[3,1],[4,2]];      // Λ
            }
        }

        // Start game
        startGameBtn.addEventListener('click', () => {
            const name = agentNameInput.value.trim();
            const amount = parseInt(transactionAmountInput.value);
            
            if (!name) {
                alert('Please enter agent name!');
                return;
            }
            
            if (!amount || amount < 1000) {
                alert('Minimum transaction amount is $1,000!');
                return;
            }
            
            sounds.click();
            vibrate(50);
            
            currentAgent = name;
            currentAmount = amount;
            spinsRemaining = 5;
            currentSpinWins = [];
            currentSpinIndex = 0;
            
            const rule = prizeRules.find(r => amount >= r.min && amount <= r.max);
            targetPrize = rule.prizes[Math.floor(Math.random() * rule.prizes.length)];
            plannedWins = generateWinsDistribution(targetPrize, 5);
            
            currentAgentEl.textContent = currentAgent;
            spinCounterEl.textContent = spinsRemaining;
            spinBtn.disabled = false;
            startGameBtn.disabled = true;
            agentNameInput.disabled = true;
            transactionAmountInput.disabled = true;
            
            totalPlayers++;
            totalPlayersEl.textContent = totalPlayers;
            createParticles(10);
        });

        // Spin animation
        async function spinReel(index, baseDuration) {
            const reel = reels[index];
            const startTop = parseInt(reel.style.top) || -333;
            const spinDistance = 1000 + Math.random() * 1500;
const finalTop = -400;

            reel.style.transition = `top ${baseDuration}ms cubic-bezier(0.2, 0.8, 0.2, 1)`;
            reel.style.top = `${startTop - spinDistance}px`;
            await new Promise(res => setTimeout(res, baseDuration - 500));

            reel.style.transition = `top 800ms cubic-bezier(0.1, 0.3, 0.1, 1)`;
            reel.style.top = `${finalTop - 100}px`;
            await new Promise(res => setTimeout(res, 600));

            reel.style.transition = `top 300ms cubic-bezier(0.3, 0.1, 0.9, 1)`;
            reel.style.top = `${finalTop}px`;
            await new Promise(res => setTimeout(res, 300));

            sounds.reelStop();

            const symbolsEls = reel.querySelectorAll('.symbol');
            symbolsEls.forEach(() => {
                const newSym = getRandomSymbol();
                const el = symbolsEls[Math.floor(Math.random() * symbolsEls.length)];
                el.innerHTML = newSym.icon;
                el.style.color = newSym.color;
                el.dataset.name = newSym.name;
            });
        }

        async function spin() {
            if (isSpinning || spinsRemaining <= 0) return;
            isSpinning = true;
            spinBtn.disabled = true;
            sounds.spin();
            vibrate([50, 50, 50]);
            
            spinResultsEl.innerHTML = '';
            totalWinEl.classList.remove('show');
            document.querySelectorAll('.payline').forEach(p => p.classList.remove('payline-active'));
            document.querySelectorAll('.symbol.winning').forEach(s => s.classList.remove('winning'));
            
            const spinDuration = 3000;
            const reelPromises = reels.map((_, i) => new Promise(res => setTimeout(() => {
                spinReel(i, spinDuration).then(res);
            }, i * 300)));
            
            await Promise.all(reelPromises);
            checkWin();
            
            spinsRemaining--;
            spinCounterEl.textContent = spinsRemaining;
            
            if (spinsRemaining > 0) spinBtn.disabled = false;
            else endGame();
            
            isSpinning = false;
        }
        spinBtn.addEventListener('click', spin);

        function checkWin() {
            const winAmount = plannedWins[currentSpinIndex++];
            if (winAmount === 0) {
                const div = document.createElement('div');
                div.className = 'spin-result no-win';
                div.innerHTML = `<div class="spin-result-label">No Win</div><div class="spin-result-value">Try Again!</div>`;
                spinResultsEl.appendChild(div);
                currentSpinWins.push(0);
                return;
            }

            // choose payline (all 5 if bet high; else only 3 horizontals)
            const lines = currentAmount > 10000 ? [1,2,3,4,5] : [1,2,3];
            const line = lines[Math.floor(Math.random()*lines.length)];
            const coords = paylineCoords(line);
            const chosenSym = getRandomSymbol();

            coords.forEach(([col,row])=>{
                const cell = reels[col].querySelectorAll('.symbol')[row+2];
                cell.innerHTML = chosenSym.icon;
                cell.style.color = chosenSym.color;
                cell.dataset.name = chosenSym.name;
                cell.classList.add('winning');
            });
            document.querySelector(`.payline-${line}`).classList.add('payline-active');

            const div = document.createElement('div');
            div.className = 'spin-result';
            if (winAmount >= 1000) div.classList.add('mega-win');
            else if (winAmount >= 500) div.classList.add('big-win');
            div.innerHTML = `<div class="spin-result-label">Line ${line}</div><div class="spin-result-value">${winAmount}</div>`;
            spinResultsEl.appendChild(div);

            sounds.win();
            vibrate([100,50,100]);
            totalWinEl.textContent = `Total Win: ${winAmount}`;
            totalWinEl.classList.add('show');

            if (winAmount >= 1000) triggerMegaWin(winAmount);
            else if (winAmount >= 500) createFireworks(5);

            currentSpinWins.push(winAmount);
        }

        function endGame() {
            const totalWon = currentSpinWins.reduce((a,b)=>a+b,0);
            agentsHistory.push({name:currentAgent,amount:currentAmount,prize:totalWon,timestamp:Date.now(),isVip:currentAmount>=50000});
            totalWinnings += totalWon;
            totalWinningsEl.textContent = totalWinnings.toLocaleString();
            updateLeaderboard();
            localStorage.setItem('agentsHistory',JSON.stringify(agentsHistory));

            setTimeout(()=>{
                spinBtn.disabled=true;
                startGameBtn.disabled=false;
                agentNameInput.disabled=false;
                transactionAmountInput.disabled=false;
                agentNameInput.value='';
                transactionAmountInput.value='';
                currentAgentEl.textContent='Waiting...';
                spinCounterEl.textContent='0';
                if(totalWon>=2000){createFireworks(20);triggerMegaWin(totalWon);}
            },3000);
        }

        function createParticles(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.width = particle.style.height = (5 + Math.random() * 10) + 'px';
                    particle.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    particle.style.animationDuration = (3 + Math.random() * 2) + 's';
                    particle.style.animationDelay = Math.random() + 's';
                    
                    particlesEl.appendChild(particle);
                    setTimeout(() => particle.remove(), 5000);
                }, i * 100);
            }
        }
        function createFireworks(count){
            for(let i=0;i<count;i++){
                setTimeout(()=>{
                    const x=Math.random()*innerWidth,y=Math.random()*innerHeight*0.5;
                    for(let j=0;j<20;j++){
                        const f=document.createElement('div');
                        f.className='firework';
                        f.style.left=x+'px';f.style.top=y+'px';
                        f.style.background=`hsl(${Math.random()*360},100%,50%)`;
                        fireworksEl.appendChild(f);
                        setTimeout(()=>f.remove(),1500);
                    }
                },i*200);
            }
        }
        function triggerMegaWin(amount){
            sounds.megaWin();
            vibrate([200,100,200,100,200]);
            megaWinText.textContent = amount>=5000?'💎 MEGA WIN! 💎':'🔥 BIG WIN! 🔥';
            megaWinOverlay.classList.add('active');
            document.body.classList.add('screen-shake');
            createParticles(50);
            createFireworks(10);
            setTimeout(()=>{megaWinOverlay.classList.remove('active');document.body.classList.remove('screen-shake');},3000);
        }

        // Leaderboard
        function updateLeaderboard(){
            let list=[...agentsHistory];
            if(currentFilter==='today'){
                const today=new Date().setHours(0,0,0,0);
                list=list.filter(a=>a.timestamp>=today);
            }else if(currentFilter==='big'){list=list.filter(a=>a.amount>=10000);}
            list.sort((a,b)=>b.prize-a.prize);
            agentsHistoryEl.innerHTML='';
            if(!list.length){
                agentsHistoryEl.innerHTML='<div class="empty-history">🎰 No winners yet. Be the first to play and claim the crown! 👑</div>';
                return;
            }
            list.slice(0,10).forEach((agent,index)=>{
                const row=document.createElement('div');
                row.className='agent-row';
                row.style.animationDelay=index*0.1+'s';
                const rankClass=index===0?'rank-1':index===1?'rank-2':index===2?'rank-3':'rank-other';
                row.innerHTML=`
                    <div class="agent-rank"><div class="rank-badge ${rankClass}">${index+1}</div></div>
                    <div class="agent-name">${agent.name}${agent.isVip?'<span class="vip-badge">VIP</span>':''}</div>
                    <div class="agent-amount">${agent.amount.toLocaleString()}</div>
                    <div class="agent-prize">${agent.prize.toLocaleString()}</div>`;
                agentsHistoryEl.appendChild(row);
            });
        }

        // Filter buttons
        filterBtns.forEach(btn=>{
            btn.addEventListener('click',()=>{
                filterBtns.forEach(b=>b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                updateLeaderboard();
                sounds.click();
            });
        });

        // Sound and vibration toggles
        soundToggle.addEventListener('click',()=>{
            soundEnabled=!soundEnabled;
            soundToggle.textContent=soundEnabled?'🔊':'🔇';
            soundToggle.classList.toggle('active');
            sounds.click();
        });
        vibrationToggle.addEventListener('click',()=>{
            vibrationEnabled=!vibrationEnabled;
            vibrationToggle.textContent=vibrationEnabled?'📳':'📵';
            vibrationToggle.classList.toggle('active');
            sounds.click();
            vibrate(50);
        });

        // Hotkeys
        document.addEventListener('keydown',e=>{
            if(e.code==='Space'&&!spinBtn.disabled){e.preventDefault();spin();}
            else if(e.key==='s'||e.key==='S'){soundToggle.click();}
            else if(e.key==='v'||e.key==='V'){vibrationToggle.click();}
        });

        // init
        window.addEventListener('load',()=>{
            initializeReels();
            createParticles(20);
        });

        transactionAmountInput.addEventListener('wheel',e=>e.preventDefault());
    </script>

    <!-- Добавь это в HTML перед закрывающим тегом body -->

<!-- Модальное окно результатов -->
<div class="game-results-overlay" id="game-results-overlay">
    <div class="game-results-modal">
        <div class="results-header">
            <h2>🎰 Game over! 🎰</h2>
            <button class="close-results-btn" id="close-results-btn">✕</button>
        </div>
        
        <div class="results-content">
            <div class="player-info">
                <div class="player-avatar">👤</div>
                <div class="player-details">
                    <h3 id="final-player-name">Agent</h3>
                    <p class="bet-amount">Transaction Amount: $<span id="final-bet-amount">0</span></p>
                </div>
            </div>
            
            <div class="spins-summary">
                <h4>Spin results:</h4>
                <div class="spins-grid" id="spins-grid">
                    <!-- Здесь будут результаты каждого спина -->
                </div>
            </div>
            
            <div class="final-results">
                <div class="total-win-display">
                    <span class="win-label">Total winnings:</span>
                    <span class="win-amount" id="final-win-amount">$0</span>
                </div>
                
                <div class="profit-display">
                    <span class="profit-label">Profit:</span>
                    <span class="profit-amount" id="final-profit-amount">$0</span>
                </div>
            </div>
            
            <div class="results-actions">
                <button class="play-again-btn" id="play-again-btn">🎮 Play again</button>
                <button class="new-player-btn" id="new-player-btn">👤 New player</button>
            </div>
        </div>
    </div>
</div>

<style>
/* Стили для модального окна результатов */
.game-results-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1001;
    animation: overlayFadeIn 0.5s ease-out;
}

@keyframes overlayFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.game-results-overlay.active {
    display: flex;
}

.game-results-modal {
    background: linear-gradient(145deg, 
        rgba(255, 255, 255, 0.15), 
        rgba(255, 255, 255, 0.1));
    backdrop-filter: blur(30px);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 24px;
    padding: 0;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        0 0 40px rgba(102, 126, 234, 0.3);
    animation: modalSlideIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: scale(0.7) translateY(-50px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.results-header {
    background: var(--primary-gradient);
    padding: 20px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
}

.results-header h2 {
    font-family: 'Orbitron', monospace;
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.close-results-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 20px;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.close-results-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.results-content {
    padding: 25px;
    color: white;
}

.player-info {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.player-avatar {
    font-size: 40px;
    width: 60px;
    height: 60px;
    background: var(--primary-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.player-details h3 {
    font-family: 'Orbitron', monospace;
    font-size: 20px;
    font-weight: 700;
    color: #4ecdc4;
    margin: 0 0 5px 0;
}

.bet-amount {
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    margin: 0;
}

.spins-summary {
    margin-bottom: 25px;
}

.spins-summary h4 {
    color: #4ecdc4;
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 15px 0;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.spins-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
}

.spin-item {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    transition: all 0.3s ease;
}

.spin-item:hover {
    border-color: rgba(78, 205, 196, 0.5);
    transform: translateY(-2px);
}

.spin-number {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
    margin-bottom: 5px;
}

.spin-win {
    font-family: 'Orbitron', monospace;
    font-size: 14px;
    font-weight: 700;
}

.spin-win.no-win {
    color: #ff6b6b;
}

.spin-win.has-win {
    color: #4ecdc4;
}

.spin-win.big-win {
    background: var(--gold-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.final-results {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    border: 2px solid rgba(78, 205, 196, 0.3);
}

.total-win-display, .profit-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.profit-display {
    margin-bottom: 0;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 10px;
}

.win-label, .profit-label {
    font-size: 16px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
}

.win-amount {
    font-family: 'Orbitron', monospace;
    font-size: 24px;
    font-weight: 900;
    background: var(--gold-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.profit-amount {
    font-family: 'Orbitron', monospace;
    font-size: 20px;
    font-weight: 700;
}

.profit-amount.positive {
    color: #4ecdc4;
}

.profit-amount.negative {
    color: #ff6b6b;
}

.profit-amount.neutral {
    color: #ffd93d;
}

.results-actions {
    display: flex;
    gap: 15px;
}

.play-again-btn, .new-player-btn {
    flex: 1;
    padding: 15px 20px;
    font-family: 'Orbitron', monospace;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 1px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    text-transform: uppercase;
    transition: all 0.3s ease;
}

.play-again-btn {
    background: var(--primary-gradient);
    color: white;
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
}

.play-again-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
}

.new-player-btn {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.new-player-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

/* Адаптивность */
@media (max-width: 768px) {
    .game-results-modal {
        max-width: 95%;
        margin: 20px;
    }
    
    .results-header h2 {
        font-size: 20px;
    }
    
    .spins-grid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .results-actions {
        flex-direction: column;
    }
    
    .win-amount {
        font-size: 20px;
    }
}
</style>

<script>
// Добавь эти переменные в начало JavaScript
const gameResultsOverlay = document.getElementById('game-results-overlay');
const closeResultsBtn = document.getElementById('close-results-btn');
const playAgainBtn = document.getElementById('play-again-btn');
const newPlayerBtn = document.getElementById('new-player-btn');

// Замени функцию endGame() на эту:
function endGame() {
    const totalWon = currentSpinWins.reduce((a, b) => a + b, 0);
    
    // Добавляем в историю
    agentsHistory.push({
        name: currentAgent,
        amount: currentAmount,
        prize: totalWon,
        timestamp: Date.now(),
        isVip: currentAmount >= 50000
    });
    
    totalWinnings += totalWon;
    totalWinningsEl.textContent = totalWinnings.toLocaleString();
    updateLeaderboard();
    localStorage.setItem('agentsHistory', JSON.stringify(agentsHistory));

    // Показываем модальное окно с результатами
    setTimeout(() => {
        showGameResults(totalWon);
        
        // Эффекты для больших выигрышей
        if (totalWon >= 2000) {
            createFireworks(20);
            triggerMegaWin(totalWon);
        }
    }, 2000);
}

// Новая функция для показа результатов
function showGameResults(totalWon) {
    // Заполняем данные игрока
    document.getElementById('final-player-name').textContent = currentAgent;
    document.getElementById('final-bet-amount').textContent = currentAmount.toLocaleString();
    document.getElementById('final-win-amount').textContent = '$' + totalWon.toLocaleString();
    
    // Рассчитываем прибыль
    const profit = totalWon - currentAmount;
    const profitEl = document.getElementById('final-profit-amount');
    profitEl.textContent = (profit >= 0 ? '+' : '') + '$' + profit.toLocaleString();
    
    if (profit > 0) {
        profitEl.className = 'profit-amount positive';
    } else if (profit < 0) {
        profitEl.className = 'profit-amount negative';
    } else {
        profitEl.className = 'profit-amount neutral';
    }
    
    // Заполняем результаты спинов
    const spinsGrid = document.getElementById('spins-grid');
    spinsGrid.innerHTML = '';
    
    currentSpinWins.forEach((win, index) => {
        const spinItem = document.createElement('div');
        spinItem.className = 'spin-item';
        
        let winClass = 'no-win';
        let winText = 'Нет';
        
        if (win > 0) {
            winClass = win >= 1000 ? 'big-win' : 'has-win';
            winText = '$' + win.toLocaleString();
        }
        
        spinItem.innerHTML = `
            <div class="spin-number">Spin ${index + 1}</div>
            <div class="spin-win ${winClass}">${winText}</div>
        `;
        
        spinsGrid.appendChild(spinItem);
    });
    
    // Показываем модальное окно
    gameResultsOverlay.classList.add('active');
    sounds.megaWin();
    vibrate([200, 100, 200]);
}

// Обработчики для кнопок модального окна
closeResultsBtn.addEventListener('click', closeGameResults);
newPlayerBtn.addEventListener('click', closeGameResults);

playAgainBtn.addEventListener('click', () => {
    closeGameResults();
    // Сохраняем текущие данные игрока для повторной игры
    setTimeout(() => {
        startGameBtn.click();
    }, 300);
});

function closeGameResults() {
    gameResultsOverlay.classList.remove('active');
    
    // Сбрасываем состояние игры
    spinBtn.disabled = true;
    startGameBtn.disabled = false;
    agentNameInput.disabled = false;
    transactionAmountInput.disabled = false;
    agentNameInput.value = '';
    transactionAmountInput.value = '';
    currentAgentEl.textContent = 'Waiting...';
    spinCounterEl.textContent = '0';
    
    // Очищаем результаты
    spinResultsEl.innerHTML = '';
    totalWinEl.classList.remove('show');
    document.querySelectorAll('.payline').forEach(p => p.classList.remove('payline-active'));
    document.querySelectorAll('.symbol.winning').forEach(s => s.classList.remove('winning'));
    
    sounds.click();
}

// Закрытие по клику вне модального окна
gameResultsOverlay.addEventListener('click', (e) => {
    if (e.target === gameResultsOverlay) {
        closeGameResults();
    }
});
</script>
</body>
</html>
